{#
/**
 * @file
 * Theme implementation for the Voting Block.
 *
 * Available variables:
 * - questions: An array of questions to vote on.
 *
 * @see template_preprocess_voting_block()
 */
#}

<div class="voting-block">
  <h2>{{ 'Vote on a Question'|t }}</h2>

  {% if questions is not empty %}
    <form action="{{ path('voting_module.submit_vote') }}" method="post" id="voting-block-form">
      <div class="form-group">
        <label for="question-select">{{ 'Select Question'|t }}</label>
        <select id="question-select" name="question_id" class="form-control">
          {% for question_id, question_label in questions %}
            <option value="{{ question_id }}">{{ question_label }}</option>
          {% endfor %}
        </select>
      </div>
      
      <div id="answers-container" class="form-group">
        {# Answers will be loaded here dynamically via JavaScript #}
      </div>

      <div class="form-group">
        <label for="rating">{{ 'Your Rating'|t }}</label>
        <input type="number" id="rating" name="rating" class="form-control" min="1" max="5" required>
      </div>

      <button type="submit" class="btn btn-primary">{{ 'Submit Vote'|t }}</button>
    </form>
  {% else %}
    <p>{{ 'No questions available for voting.'|t }}</p>
  {% endif %}
</div>

{% if questions is not empty %}
  <script>
    (function ($, Drupal) {
      Drupal.behaviors.votingBlock = {
        attach: function (context, settings) {
          $('#question-select', context).once('votingBlock').change(function () {
            var questionId = $(this).val();
            $.ajax({
              url: Drupal.url('voting_module/get_answers/' + questionId),
              type: 'GET',
              dataType: 'json',
              success: function (data) {
                var answersContainer = $('#answers-container');
                answersContainer.empty();
                if (data.length) {
                  data.forEach(function (answer) {
                    answersContainer.append(
                      '<div class="form-check">' +
                      '<input class="form-check-input" type="radio" name="answer_id" id="answer-' + answer.id + '" value="' + answer.id + '">' +
                      '<label class="form-check-label" for="answer-' + answer.id + '">' + answer.label + '</label>' +
                      '</div>'
                    );
                  });
                } else {
                  answersContainer.append('<p>{{ "No answers available for this question."|t }}</p>');
                }
              }
            });
          }).trigger('change'); // Trigger change event on page load to load answers for the first question.
        }
      };
    })(jQuery, Drupal);
  </script>
{% endif %}

{% set library = ['voting_module/voting_block'] %}
